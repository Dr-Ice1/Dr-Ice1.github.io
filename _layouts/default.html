<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>
    {% if page.title %}{{ page.title }} · {% endif %}{{ site.title | default: "Blog" }}
  </title>
  <link rel="stylesheet" href="{{ "/assets/css/main.css" | relative_url }}">
</head>
<body>
  {{ content }}
  <footer class="footer">
    <div class="container">
      <span>© {{ site.time | date: "%Y" }} {{ site.title | default: "Blog" }} made with ChatGPT</span>
    </div>
  </footer>
<script>
(function () {
  function slugify(str) {
    return str.toLowerCase()
      .trim()
      .replace(/[\s]+/g, '-')
      .replace(/[^\w\-]+/g, '')
      .replace(/\-\-+/g, '-');
  }

  function buildToc(root) {
    const headings = root.querySelectorAll('h2, h3');
    if (!headings.length) return null;

    // Ensure headings have ids
    const used = new Set();
    headings.forEach(h => {
      if (!h.id) {
        let id = slugify(h.textContent);
        let base = id;
        let i = 2;
        while (used.has(id) || document.getElementById(id)) {
          id = base + '-' + i++;
        }
        used.add(id);
        h.id = id;
      }
    });

    const toc = document.createElement('nav');
    toc.className = 'toc';
    toc.innerHTML = '<div class="toc-title">Table of contents</div>';
    const ol = document.createElement('ol');

    headings.forEach(h => {
      const li = document.createElement('li');
      if (h.tagName.toLowerCase() === 'h3') li.style.marginLeft = '12px';
      const a = document.createElement('a');
      a.href = '#' + h.id;
      a.textContent = h.textContent;
      li.appendChild(a);
      ol.appendChild(li);
    });

    toc.appendChild(ol);
    return toc;
  }

  // Replace a paragraph that is exactly "[toc]" (case-insensitive) with TOC
  document.querySelectorAll('.post-body').forEach(root => {
    const candidates = Array.from(root.querySelectorAll('p'))
      .filter(p => p.textContent.trim().toLowerCase() === '[toc]');

    candidates.forEach(p => {
      const toc = buildToc(root);
      if (toc) p.replaceWith(toc);
      else p.remove(); // no headings, remove [toc]
    });
  });
})();
</script>
</body>
</html>

